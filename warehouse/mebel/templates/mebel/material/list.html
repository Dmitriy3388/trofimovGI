{% extends "mebel/base.html" %}

{% block content %}
<h1>{% if category %}{{ category.name }}{% else %}–í—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã{% endif %}</h1>

<!-- –ö–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö -->
<div class="mb-4">
    <form method="post" action="{% url 'mebel:refresh_materials' %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-primary">
            üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
        </button>
        <small class="text-muted ms-2">–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Ä–µ–∑–µ—Ä–≤—ã –∏ –Ω–µ—Ö–≤–∞—Ç–∫—É –ø–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –∑–∞–∫–∞–∑–∞–º</small>
    </form>
</div>

<!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–∞—Ö -->
{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}
{% endif %}

<div class="categories">
    <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
    <ul>
        <li {% if not category %}class="selected"{% endif %}>
            <a href="{% url 'mebel:material_list' %}">–í—Å–µ</a>
        </li>
        {% for c in categories %}
        <li {% if category.slug == c.slug %}class="selected"{% endif %}>
            <a href="{{ c.get_absolute_url }}">{{ c.name }}</a>
        </li>
        {% endfor %}
    </ul>
</div>

{% block contents %}
<div class="container mt-4">
  <h2 class="mb-4">–°–ø–∏—Å–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</h2>
  <div>
    <table>
      <thead>
        <tr>
          <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
          <th>–¶–µ–Ω–∞</th>
          <th>–ë–∞–ª–∞–Ω—Å</th>
          <th>–ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ</th>
          <th>–î–æ—Å—Ç—É–ø–Ω–æ</th>
          <th>
            <a href="?sort=lack&order={% if current_sort == 'lack' and current_order == 'asc' %}desc{% else %}asc{% endif %}"
               style="text-decoration: none; color: inherit;">
              –ù–µ—Ö–≤–∞—Ç–∫–∞
              {% if current_sort == 'lack' %}
                {% if current_order == 'asc' %}‚Üë{% else %}‚Üì{% endif %}
              {% endif %}
            </a>
          </th>
        </tr>
      </thead>
      <tbody>
        {% for material in materials %}
        <tr class="clickable-row" data-href="{{ material.get_absolute_url }}">
          <td><strong>{{ material.name }}</strong></td>
          <td>{{ material.price }} ‚ÇΩ</td>
          <td>{{ material.balance }}</td>
          <td>{{ material.reserved }}</td>
          <td>
            <span style="color: {{ material.availability_status }}; font-weight: bold;">
              {{ material.available }}
            </span>
          </td>
          <td>
            <span style="color: {% if material.lack > 0 %}red{% else %}green{% endif %}; font-weight: bold;">
              {{ material.lack }}
            </span>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% include "mebel/material/pagination.html" with page=page_obj %}

<style>
  .table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .table th {
    background: #f8f9fa;
    padding: 1rem;
    font-weight: 600;
    text-align: left;
    border-bottom: 2px solid #dee2e6;
  }

  .table td {
    padding: 1rem;
    border-bottom: 1px solid #dee2e6;
  }

  .table tr:last-child td {
    border-bottom: none;
  }

  .clickable-row {
    cursor: pointer;
    transition: background-color 0.2s ease;
  }

  .clickable-row:hover {
    background-color: #f8f9fa;
  }

  .btn-group .btn {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const rows = document.querySelectorAll('.clickable-row');
    rows.forEach(row => {
      row.addEventListener('click', function(e) {
        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–ª–∏–∫–∏ –ø–æ –∫–Ω–æ–ø–∫–∞–º –¥–µ–π—Å—Ç–≤–∏–π
        if (!e.target.closest('.btn-group')) {
          window.location.href = this.dataset.href;
        }
      });
    });
  });
</script>
{% endblock %}